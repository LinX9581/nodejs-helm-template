# Default values for nodejs-helm-template.
# Gateway API + GKE 專案範本

replicaCount: 2

image:
  repository: asia-docker.pkg.dev/your-gcp-project/your-repo/your-app
  pullPolicy: IfNotPresent
  tag: "1.0.0"

# ---------- Service ----------
service:
  type: ClusterIP
  port: 3000

application:
  port: 3000

configMap:
  create: true
  name: ""
  data:
    DB_HOST: "10.0.0.10"
    DB_USER: "app_user"
    PORT: "3000"
    DEV_PORT: "4000"

envFrom:
  configMap:
    enabled: true
    name: ""
  configMapRefs: []
  secretRefs: []

# ---------- Gateway API (取代 nginx-ingress) ----------
gateway:
  enabled: true
  gatewayName: traefik-gateway
  gatewayNamespace: traefik

  routes:
    - hostname: app.example.com

  rules:
    - path: /test
      pathType: Exact
      redirect:
        path: /
        statusCode: 302

    - path: /wp-content
      pathType: PathPrefix

    - path: /wp-admin
      pathType: PathPrefix

    - path: /news
      pathType: PathPrefix

    - path: /cat
      pathType: PathPrefix

  redirectRoutes:
    - hostname: www.app.example.com
      targetHostname: app.example.com
      statusCode: 301

healthCheckPolicy:
  enabled: false
  requestPath: /pod-health
  checkIntervalSec: 5
  timeoutSec: 5
  healthyThreshold: 2
  unhealthyThreshold: 2

# ---------- Resources ----------
resources:
  limits:
    cpu: 200m
    memory: 1024Mi
  requests:
    cpu: 50m
    memory: 256Mi

# ---------- Autoscaling ----------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

updateStrategy:
  type: RollingUpdate
  maxUnavailable: 0
  maxSurge: 1

nodeSelector:
  workload: app
tolerations: []
affinity: {}

# 收 Trace Log 到 Tempo (由 Platform 端管理 Instrumentation CR)
# 設為 true 後 Pod 會自動被注入 OTel auto-instrumentation SDK
otel:
  enabled: true
  injectorAnnotationKey: instrumentation.opentelemetry.io/inject-nodejs
  injectorAnnotationValue: "true"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}
podSecurityContext:
  runAsNonRoot: false
  seccompProfile:
    type: RuntimeDefault
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
